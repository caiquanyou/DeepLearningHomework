# <center>猫狗分类实验报告</center>

## <center>摘要</center>

本次实验将采用深度学习中的卷积神经网络来训练猫狗照片分类模型。使用卷积神经网络建立合理的模型结构，在卷积层中设定一定数目一定大小的卷积核，通过训练数据使模型学习到能够反映出猫狗照片不同特征的卷积核权值，最后给出猫狗二分类各自的可能性的概率，通过softmax进行猫狗分类。实验中利用pytorch框架构建一个标准的卷积神经网络组织结构；对给定的猫狗照片进行预处理自划分出训练集和验证集之后进行数据训练，最终在测试集上达到86%的准确率。

### 问题描述

实验希望可以通过导入一张彩色猫或者狗的图片，输出预测是猫或者狗的二分类结果；实验需要训练基于 CNN 的深度学习模型，对测试样本进行分类，并保证最终结果准确率在75%以上。

### 解决方案

利用pytorch框架构建一个标准的卷积神经网络组织结构；数据集中的文件名是以cat/dog.num.jpg 方式命名的，比如 cat.0.jpg。使用 pytorch的 DataLoader需要将不同种类的图片分在不同的文件夹中，这里人为地讲猫狗图片分别存储在各自文件夹下。数据集中的图像大小是不固定的，但是神经网络要求输入节点的大小是固定的。所以在将图像的像素作为输入之前，需要将图像的大小进行 resize，实验中统一resize为224x224大小。

#### 损失函数设计

在这次实验中仍然使用交差熵作为损失函数，交叉熵定义如下：
$$
H_y(\hat y)=-\sum_i^n ylog\hat y
$$
其中y代表真实值，$\hat y$代表预测值，n代表需要区分的类别数，这里n取值为2，代表0为猫和1为狗。

#### 网络结构设计

第一次实验中采用规范的经典卷积神经网络结构，具体结构如下：

输入层：预处理后224\*224\*3的图片；

第一层卷积层1：设置了6个卷积核，卷积核大小为3\*3,步长为1，经过卷积层1 后输出为222\*222\*6；

第二层池化层1：使用最大池化进行下采样，池化的size选择(2,2)，得到111\*111\*6的图像特征；

第三层卷积层2：设置了18个卷积核，卷积核大小为4\*4,步长为1，经过卷积层2 后输出为108\*108\*18；

第四层池化层2：使用最大池化进行下采样，池化的size选择(2,2)，得到54\*54\*18的图像特征；

第五层全连接层：输入为54\*54\*18个单元，输出为1024个单元，每个单元与第4层中全部54\*54\*18个单元之间进行全连接；

第六层全连接层：输入为1024个单元，输出为512个单元，每个单元与第4层中全部1024个单元之间进行全连接；

第七层全连接层：输入为512个单元，输出为2个单元；

输出层：2个结果：0和1的可能性，分别对应类别为猫和狗。

第二次实验通过在全连接层后添加dropout层，调整卷积核大小，尝试提高准确率。

### 实验分析

#### 数据集介绍

数据集中的猫狗分类图像一共25000张，猫狗分别有12500张，是以cat/dog.num.jpg 方式命名的；分别人工地进行猫狗照片的预分类，放进cat和dog的文件夹下。模型训练中，使用猫和狗各10000张作为训练数据集，各2500张作为测试数据集。

#### 实验结果与分析

运行数据结果如下：

```
Epoch 1 Loss 0.0436 Accuracy 12433/22512 (55%)
Test Loss 0.0388 Accuracy 1464/2512 (58%)
Epoch 2 Loss 0.0223 Accuracy 14871/22512 (66%)
Test Loss 0.0142 Accuracy 1741/2512 (69%)
Epoch 3 Loss 0.0184 Accuracy 16003/22512 (71%)
Test Loss 0.0167 Accuracy 1826/2512 (73%)
Epoch 4 Loss 0.0360 Accuracy 16906/22512 (75%)
Test Loss 0.0209 Accuracy 1906/2512 (76%)
Epoch 5 Loss 0.0122 Accuracy 17707/22512 (79%)
Test Loss 0.0179 Accuracy 1933/2512 (77%)
Epoch 6 Loss 0.0781 Accuracy 18513/22512 (82%)
Test Loss 0.0056 Accuracy 1940/2512 (77%)
Epoch 7 Loss 0.0115 Accuracy 19556/22512 (87%)
Test Loss 0.0066 Accuracy 1943/2512 (77%)
Epoch 8 Loss 0.0369 Accuracy 20545/22512 (91%)
Test Loss 0.0032 Accuracy 1860/2512 (74%)
Epoch 9 Loss 0.0193 Accuracy 21262/22512 (94%)
Test Loss 0.0024 Accuracy 1858/2512 (74%)
Epoch 10 Loss 0.0004 Accuracy 21737/22512 (97%)
Test Loss 0.0006 Accuracy 1910/2512 (76%)
Epoch 11 Loss 0.0375 Accuracy 21914/22512 (97%)
Test Loss 0.0046 Accuracy 1785/2512 (71%)
Epoch 12 Loss 0.0004 Accuracy 22060/22512 (98%)
Test Loss 0.0001 Accuracy 1918/2512 (76%)
Epoch 13 Loss 0.0010 Accuracy 22150/22512 (98%)
Test Loss 0.0001 Accuracy 1948/2512 (78%)
```

实验中模型第一次在训练集上表现达到99%以上的准确度，但是在测试集中准确率较低于75%，没有达到要求，这说明整体模型存在过拟合，通过添加dropout层、改变卷积核大小等操作来尝试解决提高在测试集上的准确率，最终模型准确率为78%，仍存在过拟合问题，后续通过学习希望有更多操作方法能够进行改进。

### 总结

这次实验在第一次手写数字识别实验的基础上巩固了学习到的卷积神经网络的内容，这次实验同样采用了标准的卷积神经网络结构，在实验中与前一次不同的是训练集并非已经由官方处理好的统一大小的图片，而是大小各异，需要对图片进行预处理，学习了pytorch如何读取图片和剪裁图片的操作。实验中模型在训练集上表现达到99%以上的准确度，但是在训练中准确率较低仅为77%，这说明整体模型存在过拟合，通过添加dropout层、改变卷积核大小等操作来尝试解决提高在测试集上的准确率；说明调参对于模型的重要性，卷积核步长的选择也十分重要，过大的卷积核可能丢失了图像中的一些特征信息。最后，通过已经训练好的模型对自己家里的猫的照片进行分类，不同姿态的照片大部分已能正确分类为猫；希望在后续的学习中能够对模型做出更好的改进。

